<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scoreboard Control</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    h2 {
      margin-bottom: 20px;
      font-size: 24px;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .team-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .team-section h3 {
      margin-bottom: 15px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .team-color-indicator {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid white;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="number"],
    input[type="color"] {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.9);
      color: #333;
    }

    input[type="color"] {
      height: 45px;
      cursor: pointer;
    }

    .score-control {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }

    .score-display {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      font-family: monospace;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-direction: column;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-increment {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .btn-decrement {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .visibility-section {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    .toggle-btn {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      margin-bottom: 10px;
    }

    .reset-btn {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-visible {
      background: #10b981;
      box-shadow: 0 0 10px #10b981;
    }

    .status-hidden {
      background: #6b7280;
    }
  </style>
</head>
<body>
  <h2>üèÜ Scoreboard Control</h2>

  <div class="visibility-section">
    <button class="toggle-btn" id="toggleBtn">
      <span class="status-indicator status-hidden" id="statusIndicator"></span>
      <span id="toggleText">Scoreboard anzeigen</span>
    </button>
    <button class="reset-btn" id="resetBtn">‚Ü∫ Alle Scores zur√ºcksetzen</button>
  </div>

  <div class="team-section">
    <h3>
      <span class="team-color-indicator" id="colorA"></span>
      Team A
    </h3>
    <div class="form-group">
      <label for="nameA">Team Name:</label>
      <input type="text" id="nameA" placeholder="Team Alpha">
    </div>
    <div class="form-group">
      <label for="colorPickerA">Team Farbe:</label>
      <input type="color" id="colorPickerA" value="#667eea">
    </div>
    <div class="form-group">
      <label>Score:</label>
      <div class="score-control">
        <div class="score-display" id="scoreA">0</div>
        <div class="button-group">
          <button class="btn-increment" id="incrementA">+1</button>
          <button class="btn-decrement" id="decrementA">-1</button>
        </div>
      </div>
    </div>
  </div>

  <div class="team-section">
    <h3>
      <span class="team-color-indicator" id="colorB"></span>
      Team B
    </h3>
    <div class="form-group">
      <label for="nameB">Team Name:</label>
      <input type="text" id="nameB" placeholder="Team Beta">
    </div>
    <div class="form-group">
      <label for="colorPickerB">Team Farbe:</label>
      <input type="color" id="colorPickerB" value="#764ba2">
    </div>
    <div class="form-group">
      <label>Score:</label>
      <div class="score-control">
        <div class="score-display" id="scoreB">0</div>
        <div class="button-group">
          <button class="btn-increment" id="incrementB">+1</button>
          <button class="btn-decrement" id="decrementB">-1</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Socket.IO Client -->
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <!-- NodeCG Client (Inline) -->
  <script>
    (function () {
      'use strict';
      class Replicant {
        constructor(name, namespace, options = {}) {
          this.name = name;
          this.namespace = namespace;
          this.defaultValue = options.defaultValue;
          this._value = this.defaultValue;
          this.listeners = new Set();
          this.socket = io('/replicants', { path: '/socket.io', transports: ['websocket', 'polling'], reconnection: true });
          this.setupSocket();
          this.subscribe();
        }
        setupSocket() {
          this.socket.on('initial', (data) => {
            if (data.namespace === this.namespace && data.name === this.name) {
              const newValue = data.value ?? this.defaultValue;
              const oldValue = this._value;
              this._value = newValue;
              this.notifyListeners(newValue, oldValue);
            }
          });
          this.socket.on('change', (data) => {
            if (data.namespace === this.namespace && data.name === this.name) {
              const oldValue = this._value;
              this._value = data.value ?? this.defaultValue;
              this.notifyListeners(this._value, oldValue);
            }
          });
          this.socket.on('connect', () => { this.subscribe(); });
        }
        subscribe() {
          this.socket.emit('subscribe', { namespace: this.namespace, name: this.name });
        }
        get value() { return this._value ?? this.defaultValue; }
        set value(newValue) {
          const oldValue = this._value;
          this._value = newValue;
          this.socket.emit('set', { namespace: this.namespace, name: this.name, value: newValue });
          this.notifyListeners(newValue, oldValue);
        }
        on(callback) {
          this.listeners.add(callback);
          if (this._value !== undefined) callback(this._value, undefined);
        }
        notifyListeners(newValue, oldValue) {
          for (const listener of this.listeners) {
            try { listener(newValue, oldValue); } catch (error) { console.error('[NodeCG] Error:', error); }
          }
        }
      }
      window.nodecg = {
        bundleName: 'example-bundle',
        Replicant: (name, opts = {}) => { console.log(`[NodeCG] Replicant :change`); return new Replicant(name, window.nodecg.bundleName, opts); },
        sendMessage: (msg, data) => { console.log(`[NodeCG] sendMessage: `, data); const s = io('/messages', { path: '/socket.io', transports: ['websocket', 'polling'] }); s.on('connect', () => { s.emit('message', { bundleName: window.nodecg.bundleName, messageName: msg, data }); }); return Promise.resolve(); },
        listenFor: (msg, cb) => { const s = io('/messages', { path: '/socket.io', transports: ['websocket', 'polling'] }); s.on('message', (d) => { if (d.bundleName === window.nodecg.bundleName && d.messageName === msg) cb(d.data); }); }
      };
      console.log('[NodeCG] Client initialized');
    })();
  </script>
  <script>
    const nodecg = window.nodecg;

    // Elements
    const toggleBtn = document.getElementById('toggleBtn');
    const toggleText = document.getElementById('toggleText');
    const statusIndicator = document.getElementById('statusIndicator');
    const resetBtn = document.getElementById('resetBtn');

    // Team A
    const nameAInput = document.getElementById('nameA');
    const colorPickerA = document.getElementById('colorPickerA');
    const colorAIndicator = document.getElementById('colorA');
    const scoreADisplay = document.getElementById('scoreA');
    const incrementABtn = document.getElementById('incrementA');
    const decrementABtn = document.getElementById('decrementA');

    // Team B
    const nameBInput = document.getElementById('nameB');
    const colorPickerB = document.getElementById('colorPickerB');
    const colorBIndicator = document.getElementById('colorB');
    const scoreBDisplay = document.getElementById('scoreB');
    const incrementBBtn = document.getElementById('incrementB');
    const decrementBBtn = document.getElementById('decrementB');

    // Replicant
    const scoreboard = nodecg.Replicant('scoreboard');

    // Update UI from replicant
    scoreboard.on('change', (newValue) => {
      if (!newValue) return;

      // Visibility
      if (newValue.visible) {
        toggleText.textContent = 'Scoreboard ausblenden';
        statusIndicator.classList.remove('status-hidden');
        statusIndicator.classList.add('status-visible');
      } else {
        toggleText.textContent = 'Scoreboard anzeigen';
        statusIndicator.classList.remove('status-visible');
        statusIndicator.classList.add('status-hidden');
      }

      // Team A
      nameAInput.value = newValue.teamA.name;
      colorPickerA.value = newValue.teamA.color;
      colorAIndicator.style.backgroundColor = newValue.teamA.color;
      scoreADisplay.textContent = newValue.teamA.score;

      // Team B
      nameBInput.value = newValue.teamB.name;
      colorPickerB.value = newValue.teamB.color;
      colorBIndicator.style.backgroundColor = newValue.teamB.color;
      scoreBDisplay.textContent = newValue.teamB.score;
    });

    // Toggle visibility
    toggleBtn.addEventListener('click', () => {
      scoreboard.value = {
        ...(scoreboard.value || {}),
        visible: !scoreboard.value.visible,
      };
    });

    // Reset scores
    resetBtn.addEventListener('click', () => {
      if (confirm('M√∂chten Sie wirklich alle Scores zur√ºcksetzen?')) {
        nodecg.sendMessage('scoreboard:reset');
      }
    });

    // Team A controls
    incrementABtn.addEventListener('click', () => {
      nodecg.sendMessage('scoreboard:incrementTeamA');
    });

    decrementABtn.addEventListener('click', () => {
      nodecg.sendMessage('scoreboard:decrementTeamA');
    });

    nameAInput.addEventListener('change', () => {
      scoreboard.value = {
        ...(scoreboard.value || {}),
        teamA: {
          ...scoreboard.value.teamA,
          name: nameAInput.value,
        },
      };
    });

    colorPickerA.addEventListener('change', () => {
      scoreboard.value = {
        ...(scoreboard.value || {}),
        teamA: {
          ...scoreboard.value.teamA,
          color: colorPickerA.value,
        },
      };
    });

    // Team B controls
    incrementBBtn.addEventListener('click', () => {
      nodecg.sendMessage('scoreboard:incrementTeamB');
    });

    decrementBBtn.addEventListener('click', () => {
      nodecg.sendMessage('scoreboard:decrementTeamB');
    });

    nameBInput.addEventListener('change', () => {
      scoreboard.value = {
        ...(scoreboard.value || {}),
        teamB: {
          ...scoreboard.value.teamB,
          name: nameBInput.value,
        },
      };
    });

    colorPickerB.addEventListener('change', () => {
      scoreboard.value = {
        ...(scoreboard.value || {}),
        teamB: {
          ...scoreboard.value.teamB,
          color: colorPickerB.value,
        },
      };
    });
  </script>
</body>
</html>
